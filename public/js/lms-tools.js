function confirmDelete(t,i){if(confirm(t)){var s=document.createElement("form");s.method="POST",s.action=i;var e=document.createElement("input");e.type="hidden",e.name="_method",e.value="DELETE",s.appendChild(e);var n=document.createElement("input");n.type="hidden",n.name="_token",n.value=jQuery('meta[name="csrf-token"]').attr("content"),s.appendChild(n),document.body.appendChild(s),s.submit()}}function showClassNotification(t){let i=$($("#toast-template").html());i.css("border-color",t.borderColor),i.find(".toast-header").css("background-color",t.bgColor).css("color",t.textColor),i.find(".toast-icon").append($(t.icon)),i.find(".toast-title").html(t.title),i.find(".toast-body").html(t.message),$("#toast-container").append(i),i.toast({autohide:!0,delay:5e3}).toast("show");let s=$($("#notification-template").html());s.attr("href",t.url).css("border-color",t.borderColor),s.find(".notification-header").css("background-color",t.bgColor).css("color",t.textColor),s.find(".notification-title").html(t.title),s.find(".notification-icon").append($(t.icon)),s.find(".notification-body").html(t.message),$("#notifications-dropdown-container").prepend(s),$("#notification-menu").removeClass("d-none")}function showClassMessageNotification(t){let i=$($("#toast-template").html());i.css("border-color",t.borderColor),i.find(".toast-header").css("background-color",t.bgColor).css("color",t.textColor),i.find(".toast-icon").append($(t.icon)),i.find(".toast-title").html(t.title),i.find(".toast-body").html(t.message),$("#toast-container").append(i),i.toast({autohide:!0,delay:5e3}).toast("show")}let TextCounter=function(t,i=255,s=-1){this.container=$("#"+t),this.max_chars=i,this.min_chars=s;let e=this.container.val().length;this.count_container=$('<span class="float-end rounded count-message px-1" id="count_message">'+e+" / "+this.max_chars+"</span>"),e>this.max_chars||e<this.min_chars?this.count_container.removeClass("bg-secondary").addClass("text-white bg-danger"):this.count_container.removeClass("text-white bg-danger").addClass("bg-secondary"),this.count_container.insertAfter(this.container),that=this,this.container.on("keyup",(function(){let t=that.container.val().length;t>that.max_chars||t<that.min_chars?that.count_container.removeClass("bg-secondary").addClass("text-white bg-danger"):that.count_container.removeClass("text-white bg-danger").addClass("bg-secondary"),that.count_container.html(t+" / "+that.max_chars)}))},AreaDrawing=function(){function t(t,i,s){this.canvas=t,this.ctx=i,this.config={...this.getDefaults(),...s},this.width=this.canvas.width,this.height=this.canvas.height,this.isDrawing=!1,this.mouseX=0,this.mouseY=0,this.points=[],this.highlightBounds=!1,$(this.canvas).on("mouseover",this.config.mouseOver),$(this.canvas).on("mouseout",this.config.mouseOut),$(this.canvas).on("mousemove",this.config.mouseMove),$(this.canvas).on("click",this.config.click)}return t.prototype.getDefaults=function(){return{name:"New Area",capacity:null,phone:null,room_id:null,action:"",bound_background:"rgb(0 0 0 / 40%)",bound_text_stroke:"#000",bound_text_fill:"#fff",bound_text_font:"16px Monospace",highlighted_background:"rgb(137 206 0 / 40%)",highlighted_text_stroke:"#fff",highlighted_text_fill:"#000",highlighted_text_font:"18px Monospace",special_background:"rgba(196 70 1 / 40%)",special_text_stroke:"#fff",special_text_fill:"#000",special_text_font:"18px Monospace",clearFirst:!0,highlightSpecial:!1,mouseOver:$.proxy(this.onMouseOver,this),mouseOut:$.proxy(this.onMouseOut,this),mouseMove:$.proxy(this.onMouseMove,this),click:$.proxy(this.onMouseClick,this)}},t.prototype.isInsideBounds=function(t,i){let s=!1;for(let e=0,n=this.points.length-1;e<this.points.length;n=e++){const o=this.points[e].x,h=this.points[e].y,a=this.points[n].x,r=this.points[n].y;h>i!=r>i&&t<(a-o)*(i-h)/(r-h)+o&&(s=!s)}return s},t.prototype.onMouseOver=function(t){this.isDrawing&&$("html").css("cursor","crosshair")},t.prototype.onMouseOut=function(t){this.isDrawing&&$("html").css("cursor","pointer auto")},t.prototype.onMouseMove=function(t){let i=this.canvas.getBoundingClientRect(),s=t.clientX-~~i.left,e=t.clientY-~~i.top;this.isDrawing?(this.mouseX=s,this.mouseY=e,this.render()):this.points.length>2&&this.isInsideBounds(s,e)?this.highlightBounds||(this.highlightBounds=!0,this.render()):this.highlightBounds&&(this.highlightBounds=!1,this.render())},t.prototype.selectionWidth=function(){if(this.points.length>0){let t=this.points[0].x,i=this.points[0].x;for(let s=1;s<this.points.length;s++)this.points[s].x<t&&(t=this.points[s].x),this.points[s].x>i&&(i=this.points[s].x);return i-t}return 0},t.prototype.beginDrawing=function(){this.isDrawing=!0,this.points=[]},t.prototype.endDrawing=function(){this.isDrawing=!1,this.render()},t.prototype.onMouseClick=function(t){if(this.isDrawing){let i=this.canvas.getBoundingClientRect();if(this.points.push({x:t.clientX-~~i.left,y:t.clientY-~~i.top}),this.points.length>2){let t=this.points[0].x,i=this.points[0].y,s=this.points[this.points.length-1].x,e=this.points[this.points.length-1].y;s>=t-5&&s<=t+5&&e>=i-5&&e<=i+5&&(this.isDrawing=!1)}this.render()}},t.prototype.wrapText=function(t){for(var i=t.split(" "),s="",e=[],n=0;n<i.length;n++){var o=s+i[n];this.ctx.measureText(o).width>this.selectionWidth()?""===s?e.push(o):(e.push(s),s=i[n]+" "):s=o}return e.push(s),e},t.prototype.drawName=function(){if(this.config.name){let t=0,i=0;for(let s=0;s<this.points.length;s++)t+=this.points[s].x,i+=this.points[s].y;t/=this.points.length,i/=this.points.length,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.config.highlightSpecial?(this.ctx.strokeStyle=this.config.special_text_stroke,this.ctx.fillStyle=this.config.special_text_fill,this.ctx.font=this.config.special_text_font):this.highlightBounds?(this.ctx.strokeStyle=this.config.highlighted_text_stroke,this.ctx.fillStyle=this.config.highlighted_text_fill,this.ctx.font=this.config.highlighted_text_font):(this.ctx.strokeStyle=this.config.bound_text_stroke,this.ctx.fillStyle=this.config.bound_text_fill,this.ctx.font=this.config.bound_text_font);let s=this.wrapText(this.config.name),e=15;for(let n=0;n<s.length;n++)this.ctx.strokeText(s[n],t,i+n*e,this.selectionWidth()),this.ctx.fillText(s[n],t,i+n*e,this.selectionWidth())}},t.prototype.render=function(){this.config.clearFirst&&this.ctx.clearRect(0,0,this.width,this.height),this.ctx.strokeStyle="#000",this.ctx.lineWidth=1,this.ctx.beginPath();for(let t=0;t<this.points.length;t++)this.ctx.strokeRect(this.points[t].x-2,this.points[t].y-2,4,4),this.ctx.strokeRect(this.points[t].x-5,this.points[t].y-4,10,10),0===t?this.ctx.moveTo(this.points[t].x,this.points[t].y):this.ctx.lineTo(this.points[t].x,this.points[t].y);this.isDrawing?(this.points.length>0&&(this.ctx.moveTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y),this.ctx.lineTo(this.mouseX,this.mouseY)),this.ctx.stroke()):(this.ctx.closePath(),this.ctx.stroke(),this.config.highlightSpecial?this.ctx.fillStyle=this.config.special_background:this.highlightBounds?this.ctx.fillStyle=this.config.highlighted_background:this.ctx.fillStyle=this.config.bound_background,this.ctx.fill(),this.drawName())},t.prototype.clear=function(){this.points=[],this.isDrawing=!0,this.render()},t.prototype.selectionHeight=function(){if(this.points.length>0){let t=this.points[0].y,i=this.points[0].y;for(let s=1;s<this.points.length;s++)this.points[s].y<t&&(t=this.points[s].y),this.points[s].y>i&&(i=this.points[s].y);return i-t}return 0},t.prototype.getData=function(){return this.points},t.prototype.loadData=function(t){this.points=t,this.render()},t.prototype.setName=function(t){this.config.name=t},t.prototype.setAction=function(t){this.config.action=t},t}(),MapDrawings=function(){function t(i,s,e){this.container=$("#"+i),this.config={...t.defaults,...e},this.buildingAreaId=s,this.container.addClass("blueprint-container"),this.container.append("<canvas id='blueprint-"+this.buildingAreaId+"' class='w-100 h-100' width='"+this.config.width+"' height='"+this.config.height+"'></canvas>"),this.overlay=$("<div class='position-absolute top-0 left-0 w-100 h-100 bg-secondary d-flex flex-columns'><div class='spinner-border m-auto' role='status'><span class='visually-hidden'>Loading...</span></div></div>"),this.container.append(this.overlay),this.canvas=document.getElementById("blueprint-"+this.buildingAreaId),this.ctx=this.canvas.getContext("2d"),this.loadBuildingArea()}return t.defaults={height:600,width:600,highlightRoom:0},t.urls={get_building_area:"/locations/maps/area"},t.prototype.loadBuildingArea=function(){that=this,axios.get(t.urls.get_building_area+"/"+this.buildingAreaId).then((function(t){that.setupMap(t.data.data)})).catch((t=>console.log(t)))},t.prototype.setupMap=function(t){this.blueprintUrl=t.blueprint_url,this.container.css("background-image",'url("'+this.blueprintUrl+'")'),this.drawings=[];for(let i=0;i<t.rooms.length;i++){let s={name:t.rooms[i].name,room_id:t.rooms[i].id,phone:t.rooms[i].phone?.pretty,capacity:t.rooms[i].capacity,clearFirst:!1,highlightSpecial:this.config.highlightRoom===t.rooms[i].id,mouseOver:$.proxy(this.onMouseOver,this),mouseOut:$.proxy(this.onMouseOut,this),mouseMove:$.proxy(this.onMouseMove,this)},e=new AreaDrawing(this.canvas,this.ctx,s);t.rooms[i].img_data&&e.loadData(t.rooms[i].img_data),this.drawings.push(e)}this.overlay.remove(),this.render()},t.prototype.render=function(){this.ctx.clearRect(0,0,this.config.width,this.config.height);for(let t=0;t<this.drawings.length;t++)this.drawings[t].render()},t.prototype.getCanvas=function(){return this.canvas},t.prototype.getCtx=function(){return this.ctx},t.prototype.onMouseOver=function(t){},t.prototype.onMouseOut=function(t){},t.prototype.onMouseMove=function(t){t.stopPropagation();let i=this.canvas.getBoundingClientRect(),s=t.clientX-~~i.left,e=t.clientY-~~i.top,n=!1;for(let t=0;t<this.drawings.length;t++)this.drawings[t].isInsideBounds(s,e)?this.drawings[t].highlightBounds||(this.drawings[t].highlightBounds=!0,n=!0):this.drawings[t].highlightBounds&&(this.drawings[t].highlightBounds=!1,n=!0);n&&this.render()},t}(),SessionSettings=function(){function SessionSettings(t){this.pageName=t,this.settings={},this.syncSettings(),$("[save-tab]").on("click",(function(){window.sessionSettings.set("active_tab",$(this).attr("save-tab"))})),$("[save-fn]").on("click",(function(){window.sessionSettings.set("active_fn",$(this).attr("save-fn"))}))}return SessionSettings.defaults={height:600,width:600,highlightRoom:0},SessionSettings.url="/settings",SessionSettings.prototype.restoreSettings=function(){this.settings.hasOwnProperty("active_tab")&&($(".nav-link.active").removeClass("active"),$("#tab-"+this.settings.active_tab).addClass("active"),$(".tab-pane.active").removeClass("active").removeClass("show"),$("#tab-pane-"+this.settings.active_tab).addClass("active").addClass("show")),this.settings.hasOwnProperty("active_fn")&&eval(this.settings.active_fn)},SessionSettings.prototype.syncSettings=function(){let t={params:{key:this.pageName},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}};axios.get(SessionSettings.url,t).then((function(t){window.sessionSettings.settings=t.data,(""===window.sessionSettings.settings||Array.isArray(window.sessionSettings.settings))&&(window.sessionSettings.settings={}),window.sessionSettings.restoreSettings()})).catch((t=>console.log(t)))},SessionSettings.prototype.get=function(t,i=null){return this.settings.hasOwnProperty(t)?this.settings[t]:(this.set(t,i),i)},SessionSettings.prototype.set=function(t,i){this.settings[t]=i;let s={key:this.pageName,value:this.settings};axios.post(SessionSettings.url,s).then((function(t){console.log(t)})).catch((t=>console.log(t)))},SessionSettings}();
