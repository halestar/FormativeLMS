function confirmDelete(t,i){if(confirm(t)){var s=document.createElement("form");s.method="POST",s.action=i;var n=document.createElement("input");n.type="hidden",n.name="_method",n.value="DELETE",s.appendChild(n);var e=document.createElement("input");e.type="hidden",e.name="_token",e.value=jQuery('meta[name="csrf-token"]').attr("content"),s.appendChild(e),document.body.appendChild(s),s.submit()}}function showClassNotification(t){let i=$($("#toast-template").html());i.css("border-color",t.borderColor),i.find(".toast-header").css("background-color",t.bgColor).css("color",t.textColor),i.find(".toast-icon").append($(t.icon)),i.find(".toast-title").html(t.title),i.find(".toast-body").html(t.message),$("#toast-container").append(i),i.toast({autohide:!0,delay:5e3}).toast("show");let s=$($("#notification-template").html());s.attr("href",t.url).css("border-color",t.borderColor),s.find(".notification-header").css("background-color",t.bgColor).css("color",t.textColor),s.find(".notification-title").html(t.title),s.find(".notification-icon").append($(t.icon)),s.find(".notification-body").html(t.message),$("#notifications-dropdown-container").prepend(s),$("#notification-menu").removeClass("d-none")}function showClassMessageNotification(t){let i=$($("#toast-template").html());i.css("border-color",t.borderColor),i.find(".toast-header").css("background-color",t.bgColor).css("color",t.textColor),i.find(".toast-icon").append($(t.icon)),i.find(".toast-title").html(t.title),i.find(".toast-body").html(t.message),$("#toast-container").append(i),i.toast({autohide:!0,delay:5e3}).toast("show")}function generatePassword(){return Array(8).fill("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz!@#$").map(t=>t[Math.floor(crypto.getRandomValues(new Uint32Array(1))[0]/4294967296*t.length)]).join("")}function showTooltip(t,i,s={}){let n={duration:5e3,clickAway:!0,direction:"end",theme:"primary",...s};(t=$(t)).css("position","relative");let e=$('<div class="lms-tooltip lms-tooltip-'+n.direction+" lms-tooltip-"+n.theme+'"><span class="lms-tooltip-text">'+i+"</span></div>");t.append(e),n.clickAway&&e.on("blur",function(){e.remove()}),n.duration>0&&setTimeout(function(){e.remove()},n.duration)}function copyLink(t,i,s={}){navigator.clipboard.writeText(i).then(function(){showTooltip(t,"Link Copied!",s)})}let TextCounter=function(t,i=255,s=-1){this.container=$("#"+t),this.max_chars=i,this.min_chars=s;let n=this.container.val().length;this.count_container=$('<span class="float-end rounded count-message px-1" id="count_message">'+n+" / "+this.max_chars+"</span>"),n>this.max_chars||n<this.min_chars?this.count_container.removeClass("bg-secondary").addClass("text-white bg-danger"):this.count_container.removeClass("text-white bg-danger").addClass("bg-secondary"),this.count_container.insertAfter(this.container),that=this,this.container.on("keyup",function(){let t=that.container.val().length;t>that.max_chars||t<that.min_chars?that.count_container.removeClass("bg-secondary").addClass("text-white bg-danger"):that.count_container.removeClass("text-white bg-danger").addClass("bg-secondary"),that.count_container.html(t+" / "+that.max_chars)})},AreaDrawing=function(){function t(i,s,n){this.canvas=i,this.ctx=s,this.config={...t.defaults,...n},this.width=this.canvas.width,this.height=this.canvas.height,this.points=this.config.points,this.special=this.config.highlightSpecial,this.name=this.config.name,this.isDrawing=!1,this.highlight=!1}return t.defaults={name:"New Area",bound_background:"rgb(0 0 0 / 40%)",bound_text_stroke:"#000",bound_text_fill:"#fff",bound_text_font:"16px Monospace",highlighted_background:"rgb(137 206 0 / 40%)",highlighted_text_stroke:"#fff",highlighted_text_fill:"#000",highlighted_text_font:"18px Monospace",special_background:"rgba(196 70 1 / 40%)",special_text_stroke:"#fff",special_text_fill:"#000",special_text_font:"18px Monospace",highlightSpecial:!1,points:[],room_id:null},t.prototype.selectionWidth=function(){if(this.points.length>0){let t=this.points[0].x,i=this.points[0].x;for(let s=1;s<this.points.length;s++)this.points[s].x<t&&(t=this.points[s].x),this.points[s].x>i&&(i=this.points[s].x);return i-t}return 0},t.prototype.wrapText=function(t){for(var i=t.split(" "),s="",n=[],e=0;e<i.length;e++){var o=s+i[e];this.ctx.measureText(o).width>this.selectionWidth()?""===s?n.push(o):(n.push(s),s=i[e]+" "):s=o}return n.push(s),n},t.prototype.isInsideBounds=function(t,i){let s=!1;for(let n=0,e=this.points.length-1;n<this.points.length;e=n++){const o=this.points[n].x,a=this.points[n].y,h=this.points[e].x,r=this.points[e].y;a>i!=r>i&&t<(h-o)*(i-a)/(r-a)+o&&(s=!s)}return s},t.prototype.drawName=function(){if(this.name){let t=0,i=0;for(let s=0;s<this.points.length;s++)t+=this.points[s].x,i+=this.points[s].y;t/=this.points.length,i/=this.points.length,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.special?(this.ctx.strokeStyle=this.config.special_text_stroke,this.ctx.fillStyle=this.config.special_text_fill,this.ctx.font=this.config.special_text_font):this.highlight?(this.ctx.strokeStyle=this.config.highlighted_text_stroke,this.ctx.fillStyle=this.config.highlighted_text_fill,this.ctx.font=this.config.highlighted_text_font):(this.ctx.strokeStyle=this.config.bound_text_stroke,this.ctx.fillStyle=this.config.bound_text_fill,this.ctx.font=this.config.bound_text_font);let s=this.wrapText(this.name),n=15;for(let e=0;e<s.length;e++)this.ctx.strokeText(s[e],t,i+e*n,this.selectionWidth()),this.ctx.fillText(s[e],t,i+e*n,this.selectionWidth())}},t.prototype.beginDrawing=function(){this.isDrawing=!0,this.points=[]},t.prototype.clearDrawing=function(){this.points=[]},t.prototype.endDrawing=function(){this.isDrawing=!1},t.prototype.getData=function(){return this.points},t.prototype.loadData=function(t){this.points=t},t.prototype.setName=function(t){this.name=t},t.prototype.setHighlight=function(t){this.highlight=t},t.prototype.isHighlighted=function(){return this.highlight},t.prototype.setSpecial=function(t){this.special=t},t.prototype.getRoomId=function(){return this.config.room_id},t.prototype.addPoint=function(t,i){this.points.push({x:t,y:i}),this.isDrawing&&this.isShapeClosed()&&this.endDrawing()},t.prototype.isShapeClosed=function(){if(this.points.length<=2)return!1;let t=this.points[0].x,i=this.points[0].y,s=this.points[this.points.length-1].x,n=this.points[this.points.length-1].y;return s>=t-5&&s<=t+5&&n>=i-5&&n<=i+5},t.prototype.render=function(){this.ctx.strokeStyle="#000",this.ctx.lineWidth=1,this.ctx.beginPath();for(let t=0;t<this.points.length;t++)this.ctx.strokeRect(this.points[t].x-2,this.points[t].y-2,4,4),this.ctx.strokeRect(this.points[t].x-5,this.points[t].y-4,10,10),0===t?this.ctx.moveTo(this.points[t].x,this.points[t].y):this.ctx.lineTo(this.points[t].x,this.points[t].y);this.isDrawing||(this.ctx.closePath(),this.ctx.stroke(),this.special?this.ctx.fillStyle=this.config.special_background:this.highlight?this.ctx.fillStyle=this.config.highlighted_background:this.ctx.fillStyle=this.config.bound_background,this.ctx.fill(),this.drawName())},t}(),MapDrawings=function(){function t(i,s,n){this.containerName=i,this.container=$("#"+this.containerName),this.config={...t.defaults,...n},this.isDrawing=!1,this.newDrawing=null,this.container.addClass("blueprint-container"),this.container.append("<canvas id='blueprint-"+this.containerName+"' class='w-100 h-100' width='"+this.config.width+"' height='"+this.config.height+"'></canvas>"),this.overlay=$("<div class='position-absolute top-0 left-0 w-100 h-100 bg-secondary d-flex flex-columns'><div class='spinner-border m-auto' role='status'><span class='visually-hidden'>Loading...</span></div></div>"),this.canvas=document.getElementById("blueprint-"+this.containerName),this.ctx=this.canvas.getContext("2d"),this.loadBuildingArea(s),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("click",this.onMouseClick.bind(this))}return t.defaults={height:600,width:600,highlightRoom:0,action:null},t.urls={get_building_area:"/locations/areas/map"},t.prototype.setupMap=function(t){this.blueprintUrl=t.blueprint_url,this.container.css("background-image",'url("'+this.blueprintUrl+'")'),this.drawings=[];for(let i=0;i<t.rooms.length;i++){let s={name:t.rooms[i].name,room_id:t.rooms[i].id,highlightSpecial:this.config.highlightRoom===t.rooms[i].id,points:t.rooms[i].img_data},n=new AreaDrawing(this.canvas,this.ctx,s);this.drawings.push(n)}this.overlay.remove(),this.render()},t.prototype.render=function(){if(this.ctx.clearRect(0,0,this.config.width,this.config.height),this.isDrawing&&null!==this.newDrawing)this.newDrawing.render();else for(let t=0;t<this.drawings.length;t++)this.drawings[t].render()},t.prototype.loadBuildingArea=function(i){null!==this.newDrawing&&(this.isDrawing=!1,this.newDrawing.clearDrawing(),this.newDrawing=null),this.canvas.style.cursor="default",that=this,this.buildingAreaId=i,this.container.append(this.overlay),axios.get(t.urls.get_building_area+"/"+this.buildingAreaId).then(function(t){that.setupMap(t.data.data)}).catch(t=>console.log(t))},t.prototype.reload=function(){this.loadBuildingArea(this.buildingAreaId)},t.prototype.getCanvas=function(){return this.canvas},t.prototype.getCtx=function(){return this.ctx},t.prototype.highlightRoom=function(t=null){for(let i=0;i<this.drawings.length;i++)this.drawings[i].setSpecial(null!==t&&this.drawings[i].getRoomId()===t);this.render()},t.prototype.highlightRooms=function(t=[]){for(let i=0;i<this.drawings.length;i++)this.drawings[i].setSpecial(t.includes(this.drawings[i].getRoomId()));this.render()},t.prototype.removeHighlight=function(){for(let t=0;t<this.drawings.length;t++)this.drawings[t].setSpecial(!1);this.render()},t.prototype.beginDrawing=function(t="New Area"){this.isDrawing=!0,this.newDrawing=new AreaDrawing(this.canvas,this.ctx,{name:t}),this.newDrawing.beginDrawing(),this.canvas.style.cursor="crosshair",this.render()},t.prototype.endDrawing=function(){this.newDrawing.endDrawing(),this.isDrawing=!1,this.newDrawing=null,this.canvas.style.cursor="default",this.render()},t.prototype.clearDrawing=function(){this.isDrawing&&null!==this.newDrawing&&this.newDrawing.clearDrawing()},t.prototype.getDrawingBounds=function(){return this.isDrawing&&null!==this.newDrawing?this.newDrawing.getData():null},t.prototype.onMouseMove=function(t){t.stopPropagation();let i=this.canvas.getBoundingClientRect(),s=t.clientX-~~i.left,n=t.clientY-~~i.top;if(this.isDrawing&&null!==this.newDrawing){if(this.render(),this.newDrawing.points.length>0&&this.newDrawing.isDrawing){let t=this.newDrawing.points[this.newDrawing.points.length-1].x,i=this.newDrawing.points[this.newDrawing.points.length-1].y;this.ctx.moveTo(t,i),this.ctx.lineTo(s,n)}this.ctx.stroke()}else{let t=!1;for(let i=0;i<this.drawings.length;i++){let e=this.drawings[i].isInsideBounds(s,n);e&&!this.drawings[i].isHighlighted()?(this.drawings[i].setHighlight(!0),t=!0):!e&&this.drawings[i].isHighlighted()&&(this.drawings[i].setHighlight(!1),t=!0)}t&&this.render()}},t.prototype.onMouseClick=function(t){let i=this.canvas.getBoundingClientRect(),s=t.clientX-~~i.left,n=t.clientY-~~i.top;if(this.isDrawing&&null!==this.newDrawing&&this.newDrawing.isDrawing)this.newDrawing.addPoint(s,n),this.render();else if("function"==typeof this.config.action){let t=null;for(let i=0;i<this.drawings.length;i++)if(this.drawings[i].isInsideBounds(s,n)){t=this.drawings[i].getRoomId();break}null!==t&&this.config.action(t)}},t}(),SessionSettings=function(){function SessionSettings(t){this.pageName=t,this.settings={},this.syncSettings(),$("[save-tab]").on("click",function(){window.sessionSettings.set("active_tab",$(this).attr("save-tab"))}),$("[save-fn]").on("click",function(){window.sessionSettings.set("active_fn",$(this).attr("save-fn"))})}return SessionSettings.defaults={height:600,width:600,highlightRoom:0},SessionSettings.url="/settings",SessionSettings.prototype.restoreSettings=function(){this.settings.hasOwnProperty("active_tab")&&($(".nav-link.active").removeClass("active"),$("#tab-"+this.settings.active_tab).addClass("active"),$(".tab-pane.active").removeClass("active").removeClass("show"),$("#tab-pane-"+this.settings.active_tab).addClass("active").addClass("show")),this.settings.hasOwnProperty("active_fn")&&eval(this.settings.active_fn)},SessionSettings.prototype.syncSettings=function(){let t={params:{key:this.pageName},headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}};axios.get(SessionSettings.url,t).then(function(t){window.sessionSettings.settings=t.data,(""===window.sessionSettings.settings||Array.isArray(window.sessionSettings.settings))&&(window.sessionSettings.settings={}),window.sessionSettings.restoreSettings()}).catch(t=>console.log(t))},SessionSettings.prototype.get=function(t,i=null){return this.settings.hasOwnProperty(t)?this.settings[t]:(this.set(t,i),i)},SessionSettings.prototype.set=function(t,i){this.settings[t]=i;let s={key:this.pageName,value:this.settings};axios.post(SessionSettings.url,s).then(function(t){console.log(t)}).catch(t=>console.log(t))},SessionSettings.prototype.saveTo=function(t,i){let s={key:t,value:i};axios.post(SessionSettings.url,s).then(function(t){console.log(t)}).catch(t=>console.log(t))},SessionSettings}(),LmsToast=function(){function t(i,s,n=null,e={}){this.title=i,this.message=s,this.config={...t.defaultToast,...e},this.action_link=n,this.showToast()}return t.defaultToast={fa_icon:"fa-solid fa-triangle-exclamation",toast:{classes:""},toast_header:{classes:"bg-primary bg-gradient",styles:[{css:"--bs-bg-opacity",value:"0.4"}]},toast_icon:{classes:"text-primary"},toast_title:{classes:"text-capitalize"},toast_body:{classes:"text-bg-light"},autohide:!0,delay:5e3},t.messageToast={fa_icon:"fa-solid fa-message",toast:{classes:""},toast_header:{classes:"bg-primary bg-gradient",styles:[{css:"--bs-bg-opacity",value:"0.4"}]},toast_icon:{classes:"text-primary"},toast_title:{classes:"text-capitalize"},toast_body:{classes:"text-bg-light"},autohide:!0,delay:3e3},t.prototype.applyStyle=function(t,i){if("object"==typeof i&&(i.hasOwnProperty("classes")&&t.addClass(i.classes),i.hasOwnProperty("styles")))for(const s of i.styles)s.hasOwnProperty("css")&&s.hasOwnProperty("value")&&t.css(s.css,s.value)},t.prototype.showToast=function(){let t=$($("#toast-template").html());this.applyStyle(t,this.config.toast),this.applyStyle(t.find(".toast-header"),this.config.toast_header);let i=t.find(".toast-icon");this.config.hasOwnProperty("icon")?i.append($(this.config.icon)):this.config.hasOwnProperty("fa_icon")&&i.append($('<i class="'+this.config.fa_icon+'"></i>')),this.applyStyle(i,this.config.toast_icon);let s=t.find(".toast-title");this.applyStyle(s,this.config.toast_title),s.html(this.title);let n=t.find(".toast-body");if(this.applyStyle(n,this.config.toast_body),t.find(".toast-body").html(this.message),null!==this.action_link){let i=this.action_link;t.find(".toast-body").on("click",function(){window.location.href=i})}$("#toast-container").append(t),this.config.autohide?t.toast({autohide:!0,delay:this.config.delay}).toast("show"):t.toast({autohide:!1}).toast("show")},t}();
